@page "/warehouses/create"

@using LogiEdge.WarehouseService.Services
@using LogiEdge.CustomerService.Data
@using LogiEdge.CustomerService.Services
@using LogiEdge.WarehouseService.Data
@using Microsoft.AspNetCore.Components.Forms

@inject WarehouseManagementService WarehouseService;
@inject CustomerManagementService CustomerService;

@code {
    private string customerAbbreviation = string.Empty;
    private string warehouseName = string.Empty;
    private List<string> additionalProperties = new();
    private List<string> additionalPropertiesTypes = new();

    private string feedback = string.Empty;

    private void CreateNewWarehouse()
    {
        Customer? customer = CustomerService.GetCustomerByAbbreviation(customerAbbreviation);

        if(customer == null)
        {
            feedback = "Could not find the selected customer. Make sure it exists!";
            return;
        }

        if(string.IsNullOrEmpty(warehouseName))
        {
            feedback = "A name must be set for the warehouse!";
            return;
        }

        if(additionalProperties.Any(x => string.IsNullOrEmpty(x)))
        {
            feedback = "Cannot create a customer which has an empty additional property!";
            return;
        }

        if(additionalPropertiesTypes.Any(x => string.IsNullOrEmpty(x)))
        {
            feedback = "A property type must be set for all additional properties!";
            return;
        }


        WarehouseService.CreateWarehouse(new Warehouse()
            {
                Customer = customer,
                Name = warehouseName,
                AdditionalProperties = additionalProperties,
                AdditionalPropertiesTypes = additionalPropertiesTypes
            });
    }
}

<h3>Create New Warehouse</h3>

<label>Select Customer:</label>

<InputSelect @bind-Value="customerAbbreviation">
    <option value="" disabled selected hidden>Select a customer...</option>
    @foreach (Customer customer in CustomerService.GetCustomers())
    {
        <option value="@customer.Abbreviation">@customer.Name [@customer.Abbreviation]</option>
    }
</InputSelect>

<label>Warehouse Name:</label>
<InputText @bind-Value="warehouseName"></InputText>
<br />

<table>
    <tr>
        <th>Property Name</th>
        <th>Property Type</th>
    </tr>

    @for (int i = 0; i < additionalProperties.Count; i++)
    {
        int index = i;
        <tr>
            <td><InputText @bind-Value="additionalProperties[index]"></InputText></td>
            <td><InputText @bind-Value="additionalPropertiesTypes[index]"></InputText></td>
        </tr>
    }
</table>
<button @onclick="() => { additionalProperties.Add(string.Empty); additionalPropertiesTypes.Add(string.Empty); }">Add Additional Property</button>
<p style="color:red;">@feedback</p>
<br />
<button @onclick="CreateNewWarehouse">Create Warehouse</button>