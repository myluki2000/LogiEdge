@using System.Text.Json
@using LogiEdge.WarehouseService.Data
@code {
    [Parameter]
    public required IList<Item> Items { get; set; }
    [Parameter]
    public DateTime? AtDate { get; set; }
}

<span>Showing @Items.Count items.</span>
<table class="table table-striped table-hover">
    <thead class="table-primary">
        <tr>
            <th>ID</th>
            <th>Customer</th>
            <th>Item Number</th>
            <th>Location</th>
            <th>Comments</th>
            @foreach (JsonProperty property in Items.FirstOrDefault()?.AdditionalProperties.RootElement.EnumerateObject() ?? [])
            {
                <th>@property.Name</th>
            }
        </tr>
    </thead>
    <tbody>
        @foreach (Item item in Items)
        {
            ItemState? itemState = item.ItemStates.Where(st => !AtDate.HasValue || st.Date <= AtDate.Value).MaxBy(st => st.Date);

            // if there is no item state before the given date that means the item wasn't in the warehouse at this
            // point in time, so skip it
            if(itemState == null)
                continue;

            <tr>
                <td><a href="/item/@item.Id">@item.Id</a></td>
                <td><a href="/items?CustomerId=@(item.CustomerId)">@item.Customer.Name</a></td>
                <td><a href="/items?ItemNumber=@(item.ItemNumber)">@item.ItemNumber</a></td>
                <td>
                    @itemState.Location
                </td>
                <td>@item.Comments</td>
                @foreach (JsonProperty property in item.AdditionalProperties.RootElement.EnumerateObject())
                {
                    <td><a href="/items?@(property.Name)=@(property.Value)">@property.Value</a></td>
                }
            </tr>
        }
    </tbody>
</table>